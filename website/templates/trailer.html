{% extends "layout.html" %}
{% load staticfiles %}
{% block content %}
{% csrf_token %}
<div id="preloader_search" style="display: inline;">
<div id="preloader"  style="filter: alpha(opacity=100); opacity: 1; -moz-opacity: 1;">
<img class="logo" src="{% static 'images/logo1.png' %}" alt="" width="119" height="58">
<div id="status">
    <span></span>
    <span></span>
    <div style="position: absolute;left:10px; top: -25px ; color: #FFF; width : 120px"> loading ...</div>
</div>
</div>
</div>
<div class="hero mv-single-hero">
<div class="container">
<div class="row">
<div class="col-md-12"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<div ><center><h1 id="title" class="bd-hd"></h1>
<div class="fancybox-skin" style="padding: 15px; width: 845px; height: 345x;"><div class="fancybox-outer"><div class="fancybox-inner" style="overflow: auto; width: 817px; height: 322px;"><iframe id="trailer_frame" name="fancybox-frame1564357322675" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" scrolling="auto" src=""></iframe></div><br><div id="total_value" > </div><div id="real_value" > </div>

<div id="trailer_prediction" > </div><br></div><a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>

</div> 
<form id="predict_form" method="post">
{% csrf_token %}
<button onclick="Clicked(this);"  class="button_predict" style="vertical-align:middle" name="predictBtn" type="submit">
<span><b>PREDICT</b></span>
</button>
</form>
</center>
</div>

</div>
</div>
</div>
</div>
<br><br><br><br><br>
<center>
<div style="display:none;" id="output_features">
<div style="width:500px;" id="table_emotions" class="mv-user-review-item robots-nocontent"  >
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-bdaa{font-weight:bold;color:#efefef;border-color:#333333;text-align:center;vertical-align:middle}
.tg .tg-z5eq{font-weight:bold;color:#efefef;border-color:#333333;text-align:center;vertical-align:top}
.tg .tg-gwj3{color:#efefef;border-color:#333333;text-align:center;vertical-align:middle}
.tg .tg-q0wh{color:#efefef;border-color:#333333;text-align:center;vertical-align:top}
</style>
<p style="color:white; font-size:20px;"><b>Emotions</b></p>
<table class="tg" >
  <tr>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/anger.png' %}" alt="" width="40px"><br>Anger</th>
    <th class="tg-z5eq"  style="width:10%"><img class="logo" src="{% static 'images/disgust.png' %}" alt="" width="40px"><br>Disgust</th>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/fear.png' %}" alt="" width="40px"><br>Fear</th>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/happy.png' %}" alt="" width="40px"><br>Happy</th>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/sad.png' %}" alt="" width="40px"><br>Sad</th>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/surprise.png' %}" alt="" width="40px"><br>Surprise</th>
    <th class="tg-z5eq" style="width:10%"><img class="logo" src="{% static 'images/neutral.png' %}" alt="" width="40px"><br>Neutral</th>
  </tr>
  <tr>
    <td class="tg-bdaa" id="td_anger"></td>
    <td class="tg-gwj3"id="td_disgust"></td>
    <td class="tg-bdaa" id="td_fear"></td>
    <td class="tg-gwj3" id="td_happy"></td>
    <td class="tg-q0wh" id="td_sad"></td>
    <td class="tg-q0wh" id="td_surprise"></td>
    <td class="tg-q0wh" id="td_neutral"></td>
  </tr>
</table>
</div>

<div style="width:500px;"  id="table_quality" class="mv-user-review-item robots-nocontent" >
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-0piz{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:top}
.tg .tg-eiyt{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
.tg .tg-dquk{color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
</style>
<p style="color:white; font-size:20px;"><b>Color features</b></p>
<table class="tg">
  <tr>
    <th class="tg-0piz">Red</th>
    <th class="tg-0piz">Green</th>
    <th class="tg-0piz">Blue</th>
    <th class="tg-0piz">Brightness</th>
  </tr>
  <tr>
    <td class="tg-eiyt" id="td_red"></td>
    <td class="tg-dquk" id="td_green"></td>
    <td class="tg-eiyt" id="td_blue"></td>
    <td class="tg-dquk" id="td_brightness"></td>
  </tr>
</table>
</div>

<div style="width:500px;" id="table_resolution" class="mv-user-review-item robots-nocontent" >
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-0piz{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:top}
.tg .tg-eiyt{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
.tg .tg-dquk{color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
</style>
<p style="color:white; font-size:20px;"><b>Video parameters</b></p>
<table class="tg">
  <tr>
    <th class="tg-0piz">Framerate</th>
    <th class="tg-0piz">Height</th>
    <th class="tg-0piz">Width</th>
    <th class="tg-0piz">Duration</th>
  </tr>
  <tr>
    <td class="tg-eiyt" id="td_fps"></td>
    <td class="tg-dquk" id="td_height"></td>
    <td class="tg-eiyt" id="td_width"></td>
    <td class="tg-dquk" id="td_duration"></td>
  </tr>
</table>
</div>


<div style="width:500px;"  id="table_audio" class="mv-user-review-item robots-nocontent" >
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-0piz{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:top}
.tg .tg-eiyt{font-weight:bold;color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
.tg .tg-dquk{color:#efefef;border-color:#343434;text-align:center;vertical-align:middle}
</style>
<p style="color:white; font-size:20px;"><b>Audio features</b></p>
<table class="tg">
  <tr>
    <th class="tg-0piz">MFCC</th>
    <th class="tg-0piz">Beat</th>
    <th class="tg-0piz">Beat confidence</th>
  </tr>
  <tr>
    <td class="tg-eiyt"id="td_mfcc"></td>
    <td class="tg-dquk" id="td_beat"></td>
    <td class="tg-eiyt" id="td_beat_confidence"></td>
  </tr>
</table>
</div>
</div></center>
<br>

<script>
function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
};
function addCommas(nStr)
	{
		nStr += '';
		x = nStr.split('.');
		x1 = x[0];
		x2 = x.length > 1 ? '.' + x[1] : '';
		var rgx = /(\d+)(\d{3})/;
		while (rgx.test(x1)) {
			x1 = x1.replace(rgx, '$1' + ',' + '$2');
		}
		return x1 + x2;
	};
var metadata_pred_bool = false;
var trailer_pred_bool = true;
var trailer_url_id = null;
$(function() {
 
  $('#predict_form').submit(function(event) {
	if (submit.name == "predictBtn") {
	document.getElementById("predict_loading").style.display = "inline";
	
	}
	// You gotta include the csrf_token in your post data
	event.preventDefault();
	$.ajax({
		type: "POST",
	   url: '{% url 'search_query' %}',
	   data: { csrfmiddlewaretoken: '{{ csrf_token }}', fct: 'predict_value', imdb_id: getUrlParameter('id'), trailer_url: getUrlParameter('v'), metadata_pred_bool: metadata_pred_bool, trailer_pred_bool: trailer_pred_bool },
	   success: function callback(data, textStatus){
			document.getElementById("trailer_prediction").innerHTML  = "";
			lists = data.split(",");
			document.getElementById("predict_loading").style.display = "none";
            //alert(lists)
			
			if (lists[1] != 'null'){
				document.getElementById("trailer_prediction").innerHTML = addCommas(lists[1]);
                document.getElementById("output_features").style.display  = "inline";
                var val_anger = parseFloat(lists[3]);
                var val_disgust = parseFloat(lists[5]);
                var val_fear = parseFloat(lists[7]);
                var val_happy = parseFloat(lists[9]);
                var val_sad = parseFloat(lists[11]);
                var val_surprise = parseFloat(lists[13]);
                var val_neutral = parseFloat(lists[15]);
                
                var summe_emotions = val_anger + val_disgust + val_fear + val_happy + val_sad + val_surprise +val_neutral;
                
                document.getElementById("td_anger").innerHTML = parseFloat(Math.round(val_anger/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_disgust").innerHTML = parseFloat(Math.round(val_disgust/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_fear").innerHTML = parseFloat(Math.round(val_fear/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_happy").innerHTML = parseFloat(Math.round(val_happy/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_sad").innerHTML = parseFloat(Math.round(val_sad/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_surprise").innerHTML = parseFloat(Math.round(val_surprise/summe_emotions * 100)).toFixed(1) +"%";
                document.getElementById("td_neutral").innerHTML = parseFloat(Math.round(val_neutral/summe_emotions * 100)).toFixed(1) +"%";
                
                
                document.getElementById("td_red").innerHTML = parseFloat(Math.round(parseFloat(lists[17]) * 100)/100).toFixed(2);
                document.getElementById("td_green").innerHTML = parseFloat(Math.round(parseFloat(lists[19]) * 100)/100).toFixed(2);
                document.getElementById("td_blue").innerHTML = parseFloat(Math.round(parseFloat(lists[21]) * 100)/100).toFixed(2);
                document.getElementById("td_brightness").innerHTML = parseFloat(Math.round(parseFloat(lists[23]) * 100)/100).toFixed(2);
                document.getElementById("td_fps").innerHTML = parseFloat(Math.round(parseFloat(lists[25]) * 100)/100).toFixed(1);
                document.getElementById("td_width").innerHTML = parseFloat(Math.round(parseFloat(lists[26]) * 100)/100).toFixed(1);
                document.getElementById("td_height").innerHTML = parseFloat(Math.round(parseFloat(lists[27]) * 100)/100).toFixed(1);
                document.getElementById("td_duration").innerHTML = parseFloat(Math.round(parseFloat(lists[28]) * 100)/100).toFixed(2);
                document.getElementById("td_mfcc").innerHTML = parseFloat(Math.round(parseFloat(lists[29]) * 100)/100).toFixed(2);
                document.getElementById("td_beat").innerHTML = parseFloat(Math.round(parseFloat(lists[30]) * 100)/100).toFixed(2);
                document.getElementById("td_beat_confidence").innerHTML = parseFloat(Math.round(parseFloat(lists[31]) * 100)/100).toFixed(2);
                
			}
			
		},
		//error: function(xhr, status, e) {
		//	alert(status, e);
		//}
		
	});
  });

});
$.ajax({
   type: "POST",
   url: '{% url 'search_query' %}',
   data: { csrfmiddlewaretoken: '{{ csrf_token }}', fct: 'search_trailer', v: getUrlParameter('v') },
   success: function callback(data, textStatus){
                jsondata = JSON.parse(JSON.stringify(data));
                
                if(jsondata.total_value != null)
                document.getElementById("total_value").innerHTML = "<div style = 'text-align: left; color: gray; font-size:12px; float: left;'>Total Revenue:&nbsp;</div><div style = 'text-align: left; color: black; font-size:12px; float: left;'>$"+addCommas(jsondata.total_value)+"</div><br>";
                
                if(jsondata.real_value != null)
                document.getElementById("real_value").innerHTML = "<div style = 'text-align: left; color: gray; font-size:12px; float: left;'>Opening Weekends Revenue (Ground truth):&nbsp;</div><div style = 'text-align: left; color: black; font-size:12px; float: left;'>$"+addCommas(jsondata.real_value)+"</div>";
                
                if(jsondata.youtube_title != null)
				document.getElementById("title").innerHTML = jsondata.youtube_title
				
                document.getElementById("trailer_frame").src= "//www.youtube.com/embed/"+getUrlParameter('v')+"?autoplay=1&amp;autohide=1&amp;fs=1&amp;rel=0&amp;hd=1&amp;wmode=opaque&amp;enablejsapi=1&amp;ps=docs&amp;controls=1";
				
                document.getElementById("preloader_search").style.display = "none";
            }
});
</script>
{% endblock %}